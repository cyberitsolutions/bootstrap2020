Description: <short summary of the patch>
 TODO: Put a short summary on the line above and replace this paragraph
 with a longer explanation of this change. Complete the meta-information
 with other relevant fields (see below for details). To make it easier, the
 information below has been extracted from the changelog. Adjust it or drop
 it.
 .
 prayer (1.3.5-dfsg1-8PrisonPC3) bookworm; urgency=medium
 .
   * Most people do not ever trim their replies.
     As a result, as soon as someone says "XKEYSCORE" or "civil
     rights" in an email, EVERY subsequent email on that thread also
     gets held for review by intelligence staff.

     Rather than trying to recognize quoted text and confirm it has
     already passed review in an earlier email, it is much easier to
     simply default to trimming the quoted text.

     We originally considered not quoting ANYTHING, but quoting the
     first few lines seems like a reasonable compromise.
     In practice 95% of email seems to be "luv u" "luv u more" "luv u
     most" kind of threads, where each email is effectively 1 line.
     This approach should work very well for those.
     It will not work perfectly for complicated emails, but
     even lawyers usually put those into an attached docx rather than
     in the email body itself.

Author: Trent W. Buck <trentbuck@gmail.com>

---
The information above should follow the Patch Tagging Guidelines, please
checkout https://dep.debian.net/deps/dep3/ to learn about the format. Here
are templates for supplementary fields that you might want to add:

Origin: (upstream|backport|vendor|other), (<patch-url>|commit:<commit-id>)
Bug: <upstream-bugtracker-url>
Bug-Debian: https://bugs.debian.org/<bugnumber>
Bug-Ubuntu: https://launchpad.net/bugs/<bugnumber>
Forwarded: (no|not-needed|<patch-forwarded-url>)
Applied-Upstream: <version>, (<commit-url>|commit:<commid-id>)
Reviewed-By: <name and email of someone who approved/reviewed the patch>
Last-Update: 2025-08-09

--- prayer-1.3.5-dfsg1.orig/cmd/cmd_reply2.c
+++ prayer-1.3.5-dfsg1/cmd/cmd_reply2.c
@@ -149,6 +149,7 @@ add_text(struct session *session, struct
         text = utf8_from_string(pool, charset, decode_msg, len);
 
     bputs(b, ">");
+    int line_number = 0;
     for (s = text; *s;) {
         if ((s[0] == '\015') || (s[0] == '\012')) {
             if ((s[0] == '\015') && (s[1] == '\012'))
@@ -161,6 +162,10 @@ add_text(struct session *session, struct
             if ((s[0] == '-') && (s[1] == '-') && (s[2] == ' ')  &&
                 ((s[3] == '\015') || (s[3] == '\012')))
                 break;
+
+            /* If we have quoted 3 lines, stop quoting. */
+            if (++line_number > 3)
+              break;
         } else
             bputc(b, *s++);
     }
