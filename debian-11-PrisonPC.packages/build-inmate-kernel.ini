# See also
#   https://salsa.debian.org/kernel-team/linux/-/commits/master/debian/config/config
#   https://salsa.debian.org/kernel-team/linux/-/commits/master/debian/config/amd64/config
#
# FIXME: migrate from xz to zstd, i.e.
#
#           MUST       = kernel_zstd rd_zstd squashfs_zstd
#           SHOULD NOT = kernel_xz   rd_xz   squashfs_xz
#
#        This requires a couple of things:
#
#        1) convenient mmdebstrap access to tar2squashfs --compressor=zstd.
#           This needs mmdebstrap/bookworm, which needs apt/bookworm.
#           Tricky to backport.
#
#        2) COMPRESSION=zstd in initramfs-tools cannot be called with -6 (good balance).
#           It is called with -22 which is much too slow.

# <twb> This is happening in 4.20 (and several 5.x series), but not in 4.19.208.  And there are no Debian versions to bisect further...
# <twb> https://lkml.org/lkml/2020/8/11/8  looks relevant
#       https://github.com/torvalds/linux/commit/a2c4fc4d4e2c40b07534094810d915c7354d84a7
# <twb> Maybe I just have to turn off ASLR until I get to 5.10+?
#
#       MKPIGGY arch/x86/boot/compressed/piggy.S
#       AS      arch/x86/boot/compressed/piggy.o
#       LD      arch/x86/boot/compressed/vmlinux
#     ld: arch/x86/boot/compressed/pgtable_64.o:(.bss+0x0): multiple definition of `__force_order'; arch/x86/boot/compressed/kaslr_64.o:(.bss+0x0): first defined here
#     ld: arch/x86/boot/compressed/head_64.o: warning: relocation in read-only section `.head.text'
#     ld: warning: creating DT_TEXTREL in a PIE
[FIXME RE-ENABLE THIS IN 5.10+]
MUST NOT = RANDOMIZE_BASE RANDOMIZE_MEMORY

[Basic netboot functionality]
SHOULD = overlay_fs_redirect_dir overlay_fs_index
    # When working on backdated kernels, this breaks ALL THE TIME.
    # It is not worth the hassle, so just ignore it when this happens.
    gcc_plugins gcc_plugin_structleak gcc_plugin_structleak_byref_all gcc_plugin_randstruct gcc_plugin_randstruct_performance
    # Try to force users to create filenames that are well-formed and normalized UTF-8?
    unicode unicode_normalization_selftest
    # This is a hardening thing.  It might break something.
    security_safesetid
    dmabuf_move_notify
    # This is a hardening thing.  It might slow down the system noticably (0% to 5%).
    init_on_alloc_default_on init_on_free_default_on
    # New in 5.4.8 (since 5.3.9).
    # AIUI this means mmap() (i.e. most file reading) needs less overhead (less RAM).
    read_only_thp_for_fs
    # PrisonPC NFS servers are TCP-only.
    nfs_disable_udp_support
MUST =
    block net packet unix inet nfs_fs nfs_v4 blk_dev_loop squashfs squashfs_xz xz_dec_x86 tmpfs overlay_fs
    # SATA AHCI CD/DVD drives
    blk_dev_sr sata_ahci udf_fs iso9660_fs joliet
    # Firewall bits
    nf_tables nf_tables_ipv4 nft_ct nft_log
    # session-monitor panic reboot
    watchdog soft_watchdog watchdog_nowayout watchdog_handle_boot_enabled magic_sysrq
    # video
    drm_i915
    # audio
    snd_hda_generic snd_hda_codec_realtek
    # USB Keyboard & Mouse
    usb_hid hid_generic input_evdev
    # USB 1/2/3 hubs plugged into the PCIe bus, for mouse & keyboard
    usb_ohci_hcd_pci usb_ehci_pci usb_xhci_pci
    # USB 1/2/3 hubs, for mouse & keyboard
    usb_ohci_hcd usb_ehci_hcd usb_xhci_hcd
    # IR remote control (receiver - AIO H76/H81)
    ir_mceusb
    # IR remote control (transmitter - Safety Pack v2)
    ir_nec_decoder
    # IPTV
    ip_multicast ip_mroute
    # Reboot faster
    rd_xz
    # For future-proofing, enable some additional IR RC transmitter protocols?
    ir_rc5_decoder ir_rc6_decoder ir_jvc_decoder ir_sony_decoder ir_sanyo_decoder ir_sharp_decoder ir_xmp_decoder
    ir_rcmm_decoder
    # For Chromium 64 (Chromium 57 does not need it).
    # https://alloc.cyber.com.au/task/task.php?taskID=32499
    # Without advise_syscalls, the GUI says "Oh, snap!" and stderr says OOM
    # advise_syscalls might be needed?
    advise_syscalls
    # FIXME: these sound like mildly good things to enable.  Are they? —twb, Feb 2017
    # Debian Linux 4.13+ enables security_yama by default, iff apparmor is off
    security_yama
    security_dmesg_restrict
    security_perf_events_restrict
    fortify_source
    bootparam_hardlockup_panic bootparam_softlockup_panic
    # For intel-microcode
    microcode microcode_intel
    # For SPECTRE / MELTDOWN
    RETPOLINE X86_INTEL_TSX_MODE_OFF
    # This is a hardening thing.  It might slow down the system noticably.
    # It mitigates MELTDOWN-class attacks.
    # https://www.kernel.org/doc/html/latest/x86/pti.html
    page_table_isolation
    # If/when desktops (CPU + mainboard) support IOMMU, we should use it.
    # Ref. https://en.wikipedia.org/wiki/DMA_attack#Mitigations
    INTEL_IOMMU
SHOULD NOT =
    # Prior to systemd (i.e. Debian 8), we used the "pxe-kexec" package.
    # This downloaded the kernel/ramdisk/cmdline over TFTP at the START of a reboot.
    # Then the end of the reboot did kexec(2) instead of a real reboot.
    # The end result was to save about 10s off a reboot.
    # When we switched to systemd, its reboot handling was weird, so we just skipped it.
    # We have never cared enough to go back and try to "solve" pxe-kexec.
    # So fuck it, compile kexec out.
    # (Removing it is also a minor win for hardening.)
    kexec
    # Trying to fix H87 graphics (PCI ID 8086:041e). [#24195]
    # UPDATE: as the Stretch kernel (v4.9) is newer than the H87,
    #         this option is no longer relevant for H87, but
    #         it will become useful again on the *next* hardware refresh.
    # UPDATE: in v4.9 drm_i915_preliminary_hw_support became drm_i915_alpha_support.
    # UPDATE: in v4.2 drm_i915_fbdev merged into drm_fbdev_emulation.
    # UPDATE: INSTEAD of this option, add "i915.alpha_support=1" to pxelinux.cfg if/when needed.
    #drm_i915_alpha_support
    # New in 5.4: Basic module for enforcing kernel lockdown
    # NOTE: this talks about "integrity" and "confidentiality", which
    #       sounds like things we do not strictly want/need...
    # UPDATE:
    # We opt out of this because it depends on parts of the cryptography system, and
    # "no unnecessary crypto" is part of the high-level policy.
    #   security_lockdown_lsm
    #   --depends--> module_sig
    #   --depends--> module_sig_format
    #   --depends--> system_data_verification
    #   --depends--> crypto_rsa
    #   --depends--> crypto_manager
    security_lockdown_lsm security_lockdown_lsm_early lock_down_kernel_force_none

# https://github.com/systemd/systemd/blob/v250/README#L30-L164
[systemd]
MUST =
    devtmpfs cgroups inotify_user signalfd timerfd epoll unix sysfs proc_fs fhandle
    # FIXME: crypto_* here is allegedly for sd128,
    #        which appears to be needed for at least initializing /etc/machine-id.
    #        But I'm 90% sure old Debian 9 SOEs also said this in their systemd, AND
    #        they DEFINITELY have working /etc/machine-id.
    #        I think *for now* I'll leave these off, and
    #        hopefully notice if anything breaks...
    #crypto_user_api_hash crypto_hmac crypto_sha256
    dmiid
    net_ns
    user_ns
    tmpfs_xattr tmpfs_posix_acl seccomp seccomp_filter
    # FIXME: uncomment kcmp once kernel version is high enough.
    #kcmp
    # IPAddressDeny=any is a security feature used in e.g. upower.service.
    # We want it.
    bpf bpf_syscall bpf_jit have_ebpf_jit cgroup_bpf
    # RestrictFileSystems= is new in v250; nobody is using it yet.
    #bpf bpf_syscall bpf_lsm debug_info_btf lsm="⋯,bpf"
MUST NOT =
    sysfs_deprecated
    fw_loader_user_helper
    rt_group_sched
SHOULD NOT =
    # PrisonPC is currently IPv4-only, i.e. WE definitely don't need/want IPv6.
    # AFAIK systemd doesn't actually *BREAK* if you disable v6 host-wide.
    ipv6
    # PrisonPC does not care about this.
    # The only drive inmates see is an ATAPI DVD drive, and
    # we do not need to know its serial numbers.
    #     Support for some SCSI devices serial number retrieval, to
    #     create additional symlinks in /dev/disk/ and /dev/tape:
    #     https://github.com/systemd/systemd/commit/a5c724b
    blk_dev_bsg
    # PrisonPC does not use systemd autofs feature.
    # Arguably we SHOULD start doing it for $HOME.
    # https://github.com/cyberitsolutions/bootstrap2020/blob/main/debian-11-PrisonPC/user-home-dir.py#L55-L56
    autofs_fs
    # https://github.com/systemd/systemd/commit/3b920d7
    # says it's for kcmp(2), but the only places kcmp() is ACTUALLY used is
    # https://github.com/systemd/systemd/blob/main/src/basic/fd-util.c#L420-427
    # which says lack of kcmp isn't a big deal.
    # UPDATE: there's a CONFIG_KCMP now, so I'm gonna just SHOULD that.
    #         https://github.com/systemd/systemd/issues/21947
    checkpoint_restore
    # Debian does not even build systemd-oomd!
    # https://github.com/systemd/systemd/blob/v250/README#L150
    psi
    # I'm 90% sure we don't care about CPUWeight=500 CPUQuota=20%
    cgroup_sched fair_group_sched cfs_bandwidth
    # Our desktop systems do not use UEFI except in CMS (legacy BIOS) mode.
    # This might change if Secure Boot ever gets approved.
    efivar_fs efi_partition
    # We do not use dm_verity.
    # It is meant to detect Evil Maid attack when rootfs is mutable (ours isn't).
    dm_verity_verify_roothash_sig

[make squashfs a little faster]
SHOULD =     squashfs_decomp_multi_percpu squashfs_file_direct
SHOULD NOT = squashfs_decomp_single       squashfs_file_cache

[Stack Protector]
# Stack Protection is off by default in Debian Linux 3.14.
# Stack Protection is regular by default in Debian Linux 4.13.
# 4.17 and earlier
#SHOULD =     cc_stackprotector_strong
#SHOULD NOT = cc_stackprotector_none
# 4.18 and later
SHOULD =     stackprotector_strong
SHOULD NOT = stackprotector_none


## THE REST OF THIS POLICY IS SHOULD NOT / MUST NOT.
[→ General setup]
SHOULD NOT =
    # NOTE: SECURITY_APPARMOR pulls in AUDIT.
    # NOTE: systemd needs user_ns and net_ns, thus needs namespaces
                     audit                         bsd_process_acct  checkpoint_restore  kprobes
                     numa_balancing  posix_mqueue  profiling         rd_bzip2            rd_gzip
    rd_lz4           rd_lzma         rd_lzo        relay             sched_autogroup     swap
    taskstats        uselib          userfaultfd
    slub_debug
    # New in 4.19 → 5.14
    ikheaders uclamp_task
    # These are prompted for because we enable GCC_PLUGINS, and Debian does not.
    gcc_plugin_cyc_complexity  gcc_plugin_latent_entropy  gcc_plugin_structleak_verbose

[→ General setup → Configure standard kernel features (expert users)]
SHOULD NOT = sgetmask_syscall sysfs_syscall kallsyms_all

[→ General setup → Control Group support]
SHOULD NOT = blk_cgroup cgroup_cpuacct cgroup_debug cgroup_device
    cgroup_freezer cgroup_memcg cgroup_perf cgroup_pids cgroup_sched
    cpusets resource_counters

[→ Enable loadable module support]
SHOULD NOT = module_force_load module_unload
    # New in 5.4.8 (since 5.3.9).
    # Enabling this allows unusual .ko that might do bad things.
    module_allow_missing_namespace_imports
# NOTE: needed for Secure Boot (verified boot), I think!
# We opt out of this because it depends on parts of the cryptography system, and
# "no unnecessary crypto" is part of the high-level policy.
MUST NOT = MODULE_SIG

# The "naughty modules" detector misdetects "blk_wbt" as bluetooth-related.
# Since we don't care, just remove it rather than making the detector smarter.
[→ Enable the block layer]
SHOULD NOT = blk_debug_fs  blk_dev_bsglib  blk_dev_integrity blk_wbt

[→ Enable the block layer → Partition Types]
SHOULD NOT = partition_advanced

[→ Enable the block layer → IO Schedulers]
SHOULD NOT = iosched_bfq iosched_deadline mq_iosched_deadline mq_iosched_kyber

[→ Processor type and features]
MUST NOT = HYPERVISOR_GUEST
SHOULD NOT = amd_mem_encrypt amd_numa calgary_iommu crash_dump efi
    frontswap gart_iommu hotplug_cpu hwpoison_inject i8k
    memory_hotplug memtest modify_ldt_syscall net_nsh numa_emu
                   x86_16bit x86_5level x86_amd_platform_device
    x86_cpuid x86_mce_amd x86_mce_inject x86_mpparse x86_msr
    x86_pmem_legacy zbud zpool zsmalloc zswap
    legacy_vsyscall_none
    x86_iopl_ioperm
SHOULD =
    # This is a hardening thing.  It might break something.
    x86_umip

[→ Memory Management options]
SHOULD NOT =
    # only used by virtio (qemu)?
    page_reporting

[→ Power management and ACPI options]
SHOULD NOT = hibernation pm_debug sfi suspend

[→ Power management and ACPI options → ACPI (Advanced Configuration and Power Interface) Support]
SHOULD NOT = acpi_battery acpi_bgrt acpi_container acpi_dock
    acpi_initrd_table_override acpi_ipmi acpi_nfit acpi_pci_slot
    acpi_rev_override_possible acpi_sbs acpi_spcr_table

[→ Power management and ACPI options → CPU Frequency scaling]
SHOULD NOT = cpu_freq_gov_conservative cpu_freq_gov_powersave
    cpu_freq_gov_schedutil cpu_freq_gov_userspace cpu_freq_stat
    x86_acpi_cpufreq_cpb x86_amd_freq_sensitivity x86_p4_clockmod
    x86_pcc_cpufreq x86_powernow_k8 x86_speedstep_centrino

[→ Power management and ACPI options → Memory power savings]
SHOULD NOT = i7300_idle

# The "naughty modules" detector misdetects "pci_mconfig" as eMMC-related.
# Since we don't care, just remove it rather than making the detector smarter.
[→ Bus options (PCI etc.)]
MUST NOT = PCCARD PCI_STUB ISA
    # New in 5.2.9 (since 4.19.208), drives hardware made from 1988 to 1995.
    # (I'm guessing this *was* called "ISA" and just got renamed.)
    EISA
SHOULD NOT = hotplug_pci pci_ioapic pci_iov pcie_dpc pcie_ptm
    pcieaer_inject vmd pcie_dw_plat_host pci_mmconfig
    # New in 5.2.9 (since 4.19.208)
    # Amlogic SoCs's PCI controller chip.  We don't use Amlogic.
    PCI_MESON

[→ Executable file formats / Emulations]
SHOULD NOT = coredump ia32_emulation binfmt_misc x86_x32

[→ Networking support]
MUST NOT = BT HAMRADIO NFC RFKILL WIMAX WIRELESS IRDA CAN NET_IFE LWTUNNEL NET_DEVLINK
    XDP_SOCKETS_DIAG
SHOULD NOT = af_rxrpc ceph_lib net_9p psample failover
    # This is "like af_packet, but faster".
    # It appears to be a "in the cloud" thing.
    # The only things I can see ACTIVELY using it are knot (DNS server/client/utilities) and gradm2.
    # We use neither.
    # https://builders.intel.com/docs/networkbuilders/af-xdp-sockets-high-performance-networking-for-cloud-native-networking-technology-guide.pdf#page=6
    xdp_sockets

[→ Networking support → Networking options]
MUST NOT = IPV6 VSOCKETS
SHOULD NOT = atalk atm batman_adv         bridge dcb decnet
    dns_resolver ieee802154 inet_ah inet_diag inet_esp inet_ipcomp
    inet_tcp_diag inet_udp_diag inet_xfrm_mode_beet
    inet_xfrm_mode_transport inet_xfrm_mode_tunnel ip_advanced_router
    ip_dccp ip_sctp ipx l2tp lapb llc2 mpls net_fou net_ipgre_demux
    net_ipip net_key net_l3_master_dev net_mpls_gso net_sched
    netlink_diag network_secmark openvswitch packet_diag phonet rds
    tcp_cong_advanced tcp_md5sig tipc unix_diag vlan_8021q x25
    xfrm_user bpfilter
    # UPDATE: because cgroups are on due to systemd.
    cgroup_net_prio cgroup_net_classid
    # We don't use IPSec in PrisonPC at this time.
    net_ipvti security_network_xfrm
    # https://en.wikipedia.org/wiki/Multipath_TCP
    # MPTCP use case is "connet to ALL open wifi hotspots at once so I can download porn faster".
    # We do not need this.
    mptcp

[→ Networking support → Networking options → Network packet filtering framework (Netfilter)]
SHOULD NOT = ip_set ip_vs nf_conntrack_bridge

[→ Networking support → Networking options → Network packet filtering framework (Netfilter) → Core Netfilter Configuration ⇒ nft]
# Useful for debugging
SHOULD = nft_counter nft_objref nft_reject nf_tables_set
SHOULD NOT =
    nf_set                  nft_numgen              nft_connlimit
    nft_limit               nft_masq                nft_redir
    nft_nat                 nft_tunnel              nft_queue
    nft_quota               nft_compat              nft_hash
    nft_socket              nft_osf                 nft_tproxy
    nft_synproxy
    nf_dup_netdev           nft_dup_netdev          nft_fwd_netdev
[→ Networking support → Networking options → Network packet filtering framework (Netfilter) → Core Netfilter Configuration ⇒ iptables]
# Disable legacy iptables/ip6tables/arptables/ebtables entirely.
# Avoids having to blacklist individual xtables sub-bits explicitly.
MUST NOT = netfilter_xtables ip_nf_iptables ip_nf_arptables
[→ Networking support → Networking options → Network packet filtering framework (Netfilter) → Core Netfilter Configuration ⇒ common to nft AND iptables]
# This pulls in crypto_crc32c which means crypto is needed.
# Fortunately we don't use SCTP anywhere anyway.
MUST NOT = nf_ct_proto_sctp
SHOULD NOT =
    netfilter_ingress
    netfilter_netlink_acct          netfilter_netlink_queue
    netfilter_netlink_log           netfilter_netlink_osf
    nf_log_netdev
    nf_conntrack_mark               nf_conntrack_zones
    nf_conntrack_events             nf_conntrack_timestamp
    nf_conntrack_procfs             nf_conntrack_timeout
    nf_conntrack_labels
    nf_ct_proto_dccp                nf_ct_proto_udplite
    nf_conntrack_amanda             nf_conntrack_ftp
    nf_conntrack_h323               nf_conntrack_irc
    nf_conntrack_netbios_ns         nf_conntrack_snmp
    nf_conntrack_pptp               nf_conntrack_sane
    nf_conntrack_sip                nf_conntrack_tftp
    nf_ct_netlink                   nf_ct_netlink_timeout
    nf_nat

[→ Networking support → Networking options → Network packet filtering framework (Netfilter) → IP: Netfilter Configuration]
SHOULD NOT =
    nf_socket_ipv4          nf_tproxy_ipv4          nft_dup_ipv4
    nft_fib_ipv4            nf_tables_arp           nf_dup_ipv4
    nf_log_arp

[→ Networking support → Networking options → Networking testing]
SHOULD NOT = net_pktgen

# NOTE: we used to block GPIOLIB entirely (because "it might be eMMC"), but
#       it is now needed for (potentially) important Intel PCH components.
#       (PINCTRL_CHERRYVIEW, PINCTRL_INTEL, MFD_INTEL_LPSS_ACPI, …) —twb, Jan 2018
[→ Device Drivers]
# I don't know if the Intel MFDs are *really* needed!
SHOULD =
    # "Dollar Cove PMIC on some Intel Cherry Trail systems"
    intel_soc_pmic_chtdc_ti
    # "Intel Low Power Subsystem starting from Sunrisepoint (Skylake PCH)"
    mfd_intel_lpss_acpi mfd_intel_lpss_pci
    # Intel PCH we might eventually have.
    pinctrl_tigerlake pinctrl_lynxpoint
MUST NOT =
    ANDROID     BCMA       FIREWIRE   FIREWIRE_NOSY  FMC  FPGA    FSI           HSI      I2O  IIO
    INFINIBAND  IPACK_BUS  LIBNVDIMM  MCB            MD   MEMORY  MEMSTICK      MMC      MTD  NTB
    PARPORT     PWM        SPI        SSB            STM  UWB     VIRT_DRIVERS  VME_BUS  W1
    MELLANOX_PLATFORM VIRTIO_MENU
    # GPS receiver
    GNSS
    RANDOM_TRUST_CPU
    RANDOM_TRUST_BOOTLOADER
    # This is a virtio (qemu) thing
    VDPA VHOST_MENU
    # "MHI" = "modem<->host interface",
    # I guess this means smartphone modems?
    # But maybe it means VDSL modems?
    # Either way, definitely DO NOT WANT.
    MHI_BUS
SHOULD NOT =
    accessibility         chrome_platforms  connector          dax         extcon
    fusion                goldfish          gpiolib            hwspinlock  i2c
    intel_th              leds_class        macintosh_drivers  new_leds    nvmem
    powercap              pps               ptp_1588_clock     remoteproc  reset_controller
    rpmsg_qcom_glink_rpm  target_core       thunderbolt        uio         vfio
    regulator
    # NOTE: ir_mceusb (TV remote control) needs this
    #       FIXME: is this still true???
    #              The actual Kconfig dependencies do not reflect this...
    media_support
    # NOTE: igb (Intel ethernet) keeps this installed
    i2c
    ixp4xx_qmgr ixp4xx_npe interconnect
    # https://lwn.net/Articles/717125/
    # This is mostly a standard API that different ARM CPUs will use.
    # We give zero shits until/unless "PrisonPC with Secure Boot" is funded.
    tee

[→ Device Drivers → Generic Driver Options]
SHOULD NOT =
    allow_dev_coredump  debug_test_driver_remove  fw_loader_user_helper  uevent_helper
    # NOTE: r8169 ethernet driver keeps this installed
    fw_loader

[→ Device Drivers → Misc devices]
MUST NOT = VMWARE_VMCI
    # SD card readers
    MISC_RTSX_PCI MISC_RTSX_USB MISC_ALCOR_PCI
SHOULD NOT =
    ad525x_dpot     altera_stapl        apds9802als         c2port           cb710_core
    ds1682          dummy_irq           enclosure_services  hmc6352          hp_ilo
    ibm_asm         ics932s401          intel_mic_bus       intel_mic_host   isl29003
    isl29020        pch_phub            phantom             scif_bus         sensors_apds990x
    sensors_bh1770  sensors_bh1780      sensors_lis3_i2c    sensors_tsl2550  sgi_ioc4
    tifm_core       usb_switch_fsa9480  vop_bus
    sensors_npcm7xx
    habana_ai
    sensors_as370
    uacce


[→ Device Drivers → Misc devices → EEPROM support]
SHOULD NOT = eeprom_at24 eeprom_legacy eeprom_max6875 eeprom_93cx6
    eeprom_ee1004

[→ Device Drivers → Block devices]
MUST NOT = VIRTIO_BLK
SHOULD NOT =
    ata_over_eth   blk_cpq_ciss_da   blk_dev_dac960  blk_dev_drbd              blk_dev_fd
    blk_dev_nbd    blk_dev_null_blk  blk_dev_nvme    blk_dev_pciessd_mtip32xx  blk_dev_ram
    blk_dev_rbd    blk_dev_rsxx      blk_dev_skd     blk_dev_sx8               blk_dev_umem
    cdrom_pktcdvd  zram
    nvme_fc

[→ Device Drivers → SCSI device support]
MUST NOT = BLK_DEV_SD SCSI_VIRTIO  VMWARE_PVSCSI
SHOULD NOT =
    blk_dev_sr_vendor  chr_dev_osst    chr_dev_sch     chr_dev_sg          chr_dev_st
    raid_attrs         scsi_constants  scsi_dh         scsi_fc_attrs       scsi_iscsi_attrs
    scsi_logging       scsi_lowlevel   scsi_multi_lun  scsi_osd_initiator  scsi_sas_attrs
    scsi_sas_libsas    scsi_spi_attrs  scsi_srp_attrs  scsi_tgt

[→ Device Drivers → Serial ATA and Parallel ATA drivers]
SHOULD NOT = ata_sff  sata_acard_ahci  sata_pmp  sata_sil  sata_sil24

[→ Device Drivers → Network device support]
MUST NOT = WLAN VIRTIO_NET USB_NET_DRIVERS
SHOULD NOT =
    arcnet  atm_drivers         bonding   dummy       equalizer  fddi         fujitsu_es
    hippi   ieee802154_drivers  ifb       isdn        macvlan    mdio_device  net_core
    net_fc  net_sb1000          net_team  netconsole  nlmon      phylib       plip
    ppp     slip                tun       veth        vmxnet3    vxlan        wan
    net_failover
    mdio_bcm_unimac
    mdio_mvusb
    mdio_xpcs

# Ideally we support 100M/1G NICs but not 10M or 10G.
# The kernel wants me to turn off NICs by vendor, so I do.
# Leaving in Intel, Realtek, Atheros.
[→ Device Drivers → Network device support → Ethernet driver support]
SHOULD NOT =
    e100                   fealnx              ip1000               ixgb
    ixgbe                  ixgbevf             jme                  net_cadence
    net_packet_engine      net_vendor_3com     net_vendor_adaptec   net_vendor_agere
    net_vendor_alacritech  net_vendor_alteon   net_vendor_amazon    net_vendor_amd
    net_vendor_aquantia    net_vendor_aurora   net_vendor_broadcom  net_vendor_brocade
    net_vendor_cavium      net_vendor_chelsio  net_vendor_cisco     net_vendor_dec
    net_vendor_dlink       net_vendor_emulex   net_vendor_exar      net_vendor_ezchip
    net_vendor_hp          net_vendor_huawei   net_vendor_marvell   net_vendor_mellanox
    net_vendor_micrel      net_vendor_myri     net_vendor_natsemi   net_vendor_netronome
    net_vendor_nvidia      net_vendor_oki      net_vendor_qlogic    net_vendor_qualcomm
    net_vendor_rdc         net_vendor_renesas  net_vendor_rocker    net_vendor_samsung
    net_vendor_silan       net_vendor_sis      net_vendor_smsc      net_vendor_solarflare
    net_vendor_stmicro     net_vendor_sun      net_vendor_synopsys  net_vendor_tehuti
    net_vendor_ti          net_vendor_via      net_vendor_wiznet    sfc
    net_vendor_cortina net_vendor_socionext
    net_vendor_ni
    net_vendor_microsemi
    net_vendor_cadence net_vendor_neterion net_vendor_packet_engines
    net_vendor_xilinx
    net_vendor_google
    net_vendor_pensando
    net_vendor_microchip
    # "next-gen" intel ethernet chipset, new in Linux 4.17
    ice
    # 2.5Gbit/s ethernet chip.  Unlikely to be in a desktop?
    igc
    # staging driver 10Gbit/s card.
    qlge

[→ Device Drivers → Network device support → PHY Device support and infrastructure]
SHOULD NOT =
    amd_phy     aquantia_phy  at803x_phy   bcm87xx_phy    bcm_net_phylib  broadcom_phy
    cicada_phy  davicom_phy   dp83848_phy  dp83867_phy    icplus_phy      lsi_et1011c_phy
    lxt_phy     marvell_phy   micrel_phy   microchip_phy  microsemi_phy   national_phy
    qsemi_phy   realtek_phy   smsc_phy     ste10xp        teranetics_phy  vitesse_phy
    ax88796b_phy
    asix_phy
    nxp_tja11xx_phy
    adin_phy
    dp83869_phy
    bcm84881_phy

[→ Device Drivers → Input device support]
SHOULD NOT =
    input_ff_memless    input_joydev  input_joystick     input_keyboard  input_leds
    input_matrixkmap    input_misc    input_mouse        input_mousedev  input_polldev
    input_sparsekeymap  input_tablet  input_touchscreen  keyboard_gpio   rmi4_core

[→ Device Drivers → Input device support → Hardware I/O ports]
SHOULD NOT =
    gameport      serio      serio_altera_ps2  serio_ct82c710  serio_i8042  serio_libps2
    serio_pcips2  serio_raw  serio_serport

[→ Device Drivers → Character devices]
MUST NOT = NOZOMI HW_RANDOM_VIRTIO VIRTIO_CONSOLE LDISC_AUTOLOAD
    # plymouth needs all of these: UNIX98_PTYS VT TTY
SHOULD NOT =
    applicom      cyclades     devport        hw_random_amd  hw_random_tpm  hw_random_via
    ipmi_handler  isi          moxa_intellio  moxa_smartio   mwave          n_gsm
    n_hdlc        nvram        r3964          raw_driver     rocketport     serial_nonstandard
    synclink      synclink_gt  tcg_tpm        telclock       tty_printk
    # FIXME: do we need this?
    serial_dev_bus

[→ Device Drivers → Character devices → Serial drivers]
SHOULD NOT = serial_8250  serial_jsm  serial_mfd_hsu  serial_pch_uart  serial_rp2
    serial_fsl_linflexuart
    serial_sprd

[→ Device Drivers → I2C support]
SHOULD NOT = i2c_chardev i2c_mux i2c_stub i2c_compat acpi_i2c_opregion

[→ Device Drivers → I2C support → I2C Hardware Bus support]
SHOULD NOT =
    i2c_ali1535         i2c_ali1563              i2c_ali15x3     i2c_amd756          i2c_amd8111
    i2c_designware_pci  i2c_designware_platform  i2c_diolan_u2c  i2c_eg20t           i2c_i801
    i2c_isch            i2c_ismt                 i2c_kempld      i2c_nforce2         i2c_ocores
    i2c_parport_light   i2c_pca_platform         i2c_piix4       i2c_robotfuzz_osif  i2c_scmi
    i2c_simtec          i2c_sis5595              i2c_sis630      i2c_sis96x          i2c_taos_evm
    i2c_tiny_usb        i2c_via                  i2c_viapro      i2c_viperboard
    i2c_amd_mp2 i2c_nvidia_gpu

[→ Device Drivers → PPS support]
SHOULD NOT = pps_client_ldisc

[→ Device Drivers → Power supply class support]
SHOULD NOT =
    power_supply
    # NOTE: ACPI_AC (case power button support) pulls in POWER_SUPPLY,
    #       so we have to blacklist all the individual battery chips.
    battery_sbs battery_bq27xxx charger_adp5061 charger_axp20x
    battery_rt5033 charger_lt3651
    battery_max17042

[→ Device Drivers → GPIO Support]
SHOULD NOT = gpio_amdpt gpio_bt8xx gpio_sysfs gpio_winbond gpio_ws16c48
    gpio_amd_fch gpio_xilinx
    # FIXME: spotted these were turned on; I think they are not needed.
    gpio_pci_idio_16 gpio_pci_idio_24

[→ Device Drivers → Hardware Monitoring support]
# FIXME: do we really need HWMON at all?
#        My vague thinking is that it lets the kernel log when the case is about to overheat...
#        Currently selected sub-options are only
#          sensors_i5500   Intel 5500/5520/X58 temperature sensor
#          sensors_coretemp Intel Core/Core2/Atom temperature sensor
#          https://www.kernel.org/doc/html/latest/hwmon/coretemp.html
#        I'll add that as a SHOULD for now just as documentation...
SHOULD = sensors_coretemp sensors_i5500
SHOULD NOT =
    sensors_abituguru       sensors_abituguru3       sensors_acpi_power      sensors_ad7414
    sensors_ad7418          sensors_adm1021          sensors_adm1025         sensors_adm1026
    sensors_adm1029         sensors_adm1031          sensors_adm9240         sensors_ads1015
    sensors_ads7828         sensors_adt7411          sensors_adt7462         sensors_adt7470
    sensors_adt7475         sensors_amc6821          sensors_applesmc        sensors_asb100
    sensors_asc7621         sensors_atk0110          sensors_atxp1           sensors_dell_smm
    sensors_dme1737         sensors_ds1621           sensors_ds620           sensors_emc1403
    sensors_emc2103         sensors_emc6w201         sensors_f71805f         sensors_f71882fg
    sensors_f75375s         sensors_fam15h_power     sensors_fschmd          sensors_ftsteutates
    sensors_g760a           sensors_gl518sm          sensors_gl520sm         sensors_i5k_amb
    sensors_it87            sensors_jc42             sensors_k10temp         sensors_k8temp
    sensors_lineage         sensors_lm63             sensors_lm73            sensors_lm75
    sensors_lm77            sensors_lm78             sensors_lm80            sensors_lm83
    sensors_lm85            sensors_lm87             sensors_lm90            sensors_lm92
    sensors_lm93            sensors_lm95241          sensors_lm95245         sensors_ltc4151
    sensors_ltc4215         sensors_ltc4245          sensors_ltc4261         sensors_max16065
    sensors_max1619         sensors_max1668          sensors_max6639         sensors_max6642
    sensors_max6650         sensors_menf21bmc_hwmon  sensors_nct6683         sensors_nct6775
    sensors_ntc_thermistor  sensors_pc87360          sensors_pc87427         sensors_pcf8591
    sensors_sch5627         sensors_sch5636          sensors_sch56xx_common  sensors_sht21
    sensors_sis5595         sensors_smm665           sensors_smsc47b397      sensors_smsc47m1
    sensors_smsc47m192      sensors_thmc50           sensors_tmp102          sensors_tmp401
    sensors_tmp421          sensors_via686a          sensors_via_cputemp     sensors_vt1211
    sensors_vt8231          sensors_w83627ehf        sensors_w83627hf        sensors_w83781d
    sensors_w83791d         sensors_w83792d          sensors_w83793          sensors_w83795
    sensors_w83l785ts       sensors_w83l786ng
    sensors_aspeed sensors_nct7802 sensors_nct7904 sensors_w83773g
    sensors_ltc2947_i2c sensors_tmp513
    sensors_adm1177 sensors_drivetemp sensors_max31730
    sensors_axi_fan_control

[→ Device Drivers → Generic Thermal sysfs driver]
SHOULD NOT =
    thermal_hwmon thermal_gov_fair_share thermal_gov_bang_bang thermal_gov_power_allocator

[→ Device Drivers → Watchdog Timer Support]
MUST NOT = USBPCWATCHDOG
SHOULD NOT =
    60xx_wdt            acquire_wdt              advantech_wdt        alim1535_wdt
    alim7101_wdt        cadence_watchdog         cpu5_wdt             eurotech_wdt
    f71808e_wdt         hp_watchdog              i6300esb_wdt         ib700_wdt
    ibmasr              ie6xx_wdt                intel_mei_wdt        it8712f_wdt
    it87_wdt            itco_wdt                 machz_wdt            max63xx_watchdog
    menf21bmc_watchdog  ni903x_wdt               nic7018_wdt          nv_tco
    pc87413_wdt         pcipcwatchdog            sbc_epx_c3_watchdog  sbc_fitpc2_watchdog
    sc1200_wdt          smsc37b787_wdt           smsc_sch311x_wdt     sp5100_tco
    via_wdt             w83627hf_wdt             w83877f_wdt          w83977f_wdt
    wafer_wdt           watchdog_pretimeout_gov  watchdog_sysfs       wdat_wdt
    wdtpci              ziirave_watchdog
    ebc_c384_wdt
    tqmx86_wdt

[→ Device Drivers → Multifunction device drivers]
MUST NOT = MFD_RTSX_USB
SHOULD NOT =
    htc_i2cpld      intel_soc_pmic    intel_soc_pmic_bxtwc  intel_soc_pmic_chtwc
    lpc_ich         lpc_sch           mfd_88pm800           mfd_88pm805
    mfd_88pm860x    mfd_aat2870_core  mfd_as3711            mfd_axp20x_i2c
    mfd_bd9571mwv   mfd_da9052_i2c    mfd_da9055            mfd_da9062
    mfd_da9063      mfd_da9150        mfd_dln2              mfd_intel_quark_i2c_gpio
    mfd_kempld      mfd_lp8788        mfd_max14577          mfd_max77693
    mfd_max77843    mfd_max8907       mfd_max8925           mfd_max8997
    mfd_max8998     mfd_menf21bmc     mfd_mt6397            mfd_palmas
    mfd_rc5t583     mfd_rt5033        mfd_rtsx_pci          mfd_sec_core
    mfd_sky81452    mfd_smsc          mfd_ti_lmu            mfd_ti_lp873x
    mfd_timberdale  mfd_tps65086      mfd_tps65090          mfd_tps6586x
    mfd_tps65910    mfd_tps65912      mfd_tps65912_i2c      mfd_tps68470
    mfd_tps80031    mfd_viperboard    mfd_wm831x_i2c        mfd_wm8350_i2c
    mfd_wm8400      mfd_wm8994        pmic_adp5520          pmic_da903x
    twl4030_core    twl6040_core
    mfd_madera
    mfd_at91_usart
    mfd_tqmx86
    mfd_iqs62x

[→ Device Drivers → Multimedia support]
MUST NOT =
    MEDIA_RADIO_SUPPORT RADIO_ADAPTERS MEDIA_USB_SUPPORT MEDIA_SDR_SUPPORT
SHOULD NOT =
    cypress_firmware      dvb_tuner_dib0070  dvb_tuner_dib0090         media_analog_tv_support
    media_camera_support  media_cec_support  media_digital_tv_support  media_pci_support
    rc_map

# UPDATE: in Debian 8 switched from lircd to ir-keytable.
[→ Device Drivers → Multimedia support → Remote controller decoders]
SHOULD NOT =
    ir_imon  ir_lirc_codec  ir_mce_kbd_decoder  ir_rc5_sz_decoder  lirc
    ir_imon_decoder ir_imon_raw

[→ Device Drivers → Multimedia support → Remote Controller devices]
SHOULD NOT =
    ir_ene       ir_fintek  ir_igorplususb  ir_iguana     ir_irmon    ir_ite_cir      ir_nuvoton
    ir_redrat3   ir_serial  ir_sir          ir_streamzap  ir_ttusbir  ir_winbond_cir  rc_ati_remote
    rc_loopback
    rc_xbox_dvd
    ir_igorplususb

[→ Device Drivers → Graphics support]
MUST NOT =
    DRM_BOCHS  DRM_CIRRUS_QEMU  DRM_QXL  DRM_UDL  DRM_VIRTIO_GPU  DRM_VMWGFX
SHOULD NOT =
    agp         drm_amdgpu              drm_ast         drm_debug_mm            drm_fbdev_emulation
    drm_gma500  drm_i2c_ch7006          drm_i2c_sil164  drm_i915_capture_error  drm_i915_gvt
    drm_legacy  drm_load_edid_firmware  drm_mgag200     drm_nouveau             drm_radeon
    drm_vgem    vga_arb                 vga_switcheroo
    drm_vboxvideo
    drm_dp_aux_chardev
    drm_i2c_nxp_tda9950
    drm_dp_cec
    drm_vkms
    drm_i915_debug_runtime_pm drm_etnaviv
    drm_gm12u320
    drm_debug_dp_mst_topology_refs

[→ Device Drivers → Graphics support → /dev/agpgart (AGP Support)]
SHOULD NOT = agp_sis agp_via

[→ Device Drivers → Graphics support → Support for frame buffer devices]
SHOULD NOT =
    fb_3dfx      fb_arc      fb_ark           fb_aty      fb_aty128   fb_cirrus        fb_cyber2000
    fb_hga       fb_kyro     fb_le80578       fb_matrox   fb_mb862xx  fb_mode_helpers  fb_n411
    fb_neomagic  fb_pm2      fb_pm3           fb_radeon   fb_s3       fb_savage        fb_simple
    fb_sis       fb_smscufx  fb_tileblitting  fb_trident  fb_udl      fb_uvesa         fb_vesa
    fb_vga16     fb_via      fb_virtual       fb_voodoo1  fb_vt8623   firmware_edid

[→ Device Drivers → Graphics support → Backlight & LCD device support]
SHOULD NOT = backlight_apple backlight_qcom_wled

[→ Device Drivers → Graphics support → Console display driver support]
SHOULD NOT =
    #framebuffer_console
    framebuffer_console_rotation  vga_console

[→ Device Drivers → Sound card support → Advanced Linux Sound Architecture]
MUST NOT =
    SND_USB
SHOULD NOT =
    snd_drivers         snd_hda_input_beep  snd_hda_reconfig  snd_mixer_oss  snd_ossemul
    snd_pcm_oss         snd_seq_dummy       snd_sequencer     snd_soc        snd_support_old_api
    snd_verbose_procfs  snd_x86
    # New in 5.4
    # Something to do with "digital microphones".
    # I think leave enabled (or rather, Debian default) for now?
    #snd_hda_intel_detect_dmic

[→ Device Drivers → Sound card support → Advanced Linux Sound Architecture → Generic sound devices]
SHOULD NOT =
    snd_aloop snd_dummy snd_mpu401 snd_mtpav snd_pcsp snd_serial_u16550 snd_virmidi

[→ Device Drivers → Sound card support → Advanced Linux Sound Architecture → PCI sound devices]
SHOULD NOT =
    snd_ad1889    snd_ali5451       snd_als300         snd_als4000   snd_asihpi
    snd_atiixp    snd_atiixp_modem  snd_au8810         snd_au8820    snd_au8830
    snd_azt3328   snd_bt87x         snd_ca0106         snd_cmipci    snd_cs4281
    snd_cs46xx    snd_cs5530        snd_cs5535audio    snd_ctxfi     snd_darla20
    snd_darla24   snd_echo3g        snd_emu10k1        snd_emu10k1x  snd_ens1370
    snd_ens1371   snd_es1938        snd_es1968         snd_fm801     snd_gina20
    snd_gina24    snd_hdsp          snd_hdspm          snd_ice1712   snd_ice1724
    snd_indigo    snd_indigodj      snd_indigodjx      snd_indigoio  snd_indigoiox
    snd_intel8x0  snd_intel8x0m     snd_korg1212       snd_layla20   snd_layla24
    snd_lola      snd_lx6464es      snd_maestro3       snd_mia       snd_mixart
    snd_mona      snd_nm256         snd_oxygen         snd_pcxhr     snd_riptide
    snd_rme32     snd_rme96         snd_rme9652        snd_se6x      snd_sonicvibes
    snd_trident   snd_via82xx       snd_via82xx_modem  snd_virtuoso  snd_vx222
    snd_ymfpci

[→ Device Drivers → Sound card support → Advanced Linux Sound Architecture → PCI sound devices → Intel HD Audio]
SHOULD NOT =
    snd_hda_codec_analog    snd_hda_codec_ca0110    snd_hda_codec_ca0132  snd_hda_codec_cirrus
    snd_hda_codec_cmedia    snd_hda_codec_conexant  snd_hda_codec_hdmi    snd_hda_codec_si3054
    snd_hda_codec_sigmatel  snd_hda_codec_via       snd_hda_hwdep         snd_hda_patch_loader

[→ Device Drivers → HID support]
SHOULD NOT =
    hidraw uhid hid_battery_strength intel_ish_hid

[→ Device Drivers → HID support → Special HID drivers]
SHOULD NOT =
    hid_a4tech        hid_accutouch     hid_acrux           hid_alps
    hid_apple         hid_appleir       hid_asus            hid_aureal
    hid_belkin        hid_betop_ff      hid_cherry          hid_chicony
    hid_cmedia        hid_corsair       hid_cp2112          hid_cypress
    hid_dragonrise    hid_elecom        hid_elo             hid_ems_ff
    hid_ezkey         hid_gembird       hid_gfrm            hid_greenasia
    hid_gt683r        hid_gyration      hid_holtek          hid_huion
    hid_icade         hid_ite           hid_kensington      hid_keytouch
    hid_kye           hid_lcpower       hid_led             hid_lenovo
    hid_lenovo_tpkbd  hid_logitech      hid_logitech_hidpp  hid_magicmouse
    hid_mayflash      hid_microsoft     hid_monterey        hid_multitouch
    hid_nti           hid_ntrig         hid_ortek           hid_pantherlord
    hid_penmount      hid_petalynx      hid_picolcd         hid_plantronics
    hid_primax        hid_prodikeys     hid_retrode         hid_rmi
    hid_roccat        hid_saitek        hid_samsung         hid_sensor_custom_sensor
    hid_sensor_hub    hid_smartjoyplus  hid_sony            hid_speedlink
    hid_steelseries   hid_sunplus       hid_thingm          hid_thrustmaster
    hid_tivo          hid_topseed       hid_twinhan         hid_uclogic
    hid_udraw_ps3     hid_wacom         hid_waltop          hid_wiimote
    hid_xinmo         hid_zeroplus      hid_zydacron
    hid_redragon hid_steam
    hid_cougar
    hid_macally hid_viewsonic hid_maltron
    hid_creative_sb0540
    hid_jabra
    hid_glorious
    hid_mcp2221

[→ Device Drivers → HID support → USB HID support]
SHOULD NOT =
    hid_pid usb_hiddev

[→ Device Drivers → HID support → I2C HID support]
MUST NOT =
    I2C_HID

[→ Device Drivers → USB support]
MUST NOT =
    TYPEC                   TYPEC_TCPM        TYPEC_UCSI                USB_ACM
    USB_ADUTUX              USB_APPLEDISPLAY  USB_ATM                   USB_CATC
    USB_CDC_PHONET          USB_CHAOSKEY      USB_CYPRESS_CY7C63        USB_CYTHERM
    USB_EHSET_TEST_FIXTURE  USB_EMI26         USB_EMI62                 USB_ETH
    USB_EZUSB_FX2           USB_FTDI_ELAN     USB_FUNCTIONFS            USB_GADGET
    USB_GADGETFS            USB_G_SERIAL      USB_IDMOUSE               USB_IOWARRIOR
    USB_IPHETH              USB_ISIGHTFW      USB_KAWETH                USB_LCD
    USB_LD                  USB_LED           USB_LEDS_TRIGGER_USBPORT  USB_LEGOTOWER
    USB_MDC800              USB_MICROTEK      USB_MON                   USB_PEGASUS
    USB_PHY                 USB_PRINTER       USB_RIO500                USB_RTL8150
    USB_RTL8152             USB_SERIAL        USB_SEVSEG                USB_SISUSBVGA
    USB_SL811_HCD           USB_STORAGE       USB_TEST                  USB_TMC
    USB_TRANCEVIBRATOR      USB_U132_HCD      USB_UAS                   USB_USBNET
    USB_WDM                 USB_WUSB_CBAF     USB_YUREX
    USB_EHCI_FSL
    USB_CONN_GPIO
    USB_CDNS3
    USB_ROLE_SWITCH
    USB4
    APPLE_MFI_FASTCHARGE
SHOULD NOT =
    usb_ohci_hcd_platform  usb_ehci_hcd_platform  usb_xhci_platform

[→ Device Drivers → EDAC (Error Detection And Correction) reporting]
SHOULD NOT =
    edac_mm_edac edac_legacy_sysfs edac_decode_mce

[→ Device Drivers → Real Time Clock]
SHOULD NOT =
    rtc_nvmem

[→ Device Drivers → DMA Engine support]
MUST NOT =
    # only used by qemu?
    UDMABUF
SHOULD NOT =
    qcom_hidma qcom_hidma_mgmt dw_dmac dw_dmac_pci altera_msgdma
    dw_edma dw_edma_pcie
    sf_pdma
    dmabuf_heaps
    # This is a "xeon" thing, so probably servers only?
    intel_idxd
    # I think this is for special subset of PCIe chips that do
    # lane-splitting, e.g. for 4 NVMe cards on one 4-lane PCIe slot.
    # Probably not on a PrisonPC desktop anyway.
    plx_dma

[→ Device Drivers → Virtio drivers]
MUST NOT =
    VIRTIO_BALLOON  VIRTIO_PCI

[→ Device Drivers → Staging drivers]
MUST NOT =
    WIMAX_GDM72XX  staging_media
SHOULD NOT =
    comedi crystalhd et131x line6_usb lirc_staging lustre_fs rts5139 rts5208 speakup usbip_core
    # lnet is a helper for lustre_fs
    lnet
    staging_gasket_framework xil_axis_fifo erofs_fs
    fieldbus_dev

# The "naughty modules" detector misdetects "intel_vbtn" as bluetooth-related.
# Since we don't care, just remove it rather than making the detector smarter.
[→ Device Drivers → X86 Platform Specific Device Drivers]
MUST NOT =
    TOSHIBA_BT_RFKILL HP_WIRELESS ASUS_WIRELESS ACER_WIRELESS
SHOULD NOT =
    acer_wmi      acerhdf        acpi_cmpc            acpi_toshiba    alienware_wmi
    apple_gmux    asus_laptop    dell_laptop          dell_smo8800    dell_wmi
    dell_wmi_aio  dell_wmi_led   fujitsu_laptop       fujitsu_tablet  hp_accel
    hp_wmi        ibm_rtl        intel_ips            intel_rst       intel_smartconnect
    msi_wmi       mxm_wmi        panasonic_laptop     pvpanic         samsung_laptop
    samsung_q10   sensors_hdaps  surface_pro3_button  thinkpad_acpi   topstar_laptop
    toshiba_haps  wmi_bmof
    dell_smbios
    gpd_pocket_fan
    intel_vbtn
    intel_atomisp2_pm
    lg_laptop huawei_wmi xiaomi_wmi
    peaq_wmi toshiba_wmi
    system76_acpi
    surface_3_power_opregion
    # PrisonPC desktops aren't expected to have thunderbolt.
    # They only have USB at all for the keyboard/mouse.
    intel_wmi_thunderbolt
    # Only applies to intel xeon *servers*
    intel_speed_select_interface

[→ Device Drivers → PHY Subsystem]
MUST NOT =
    # This is clearly a eMMC (i.e. soldered-on hard disk) driver.
    phy_intel_emmc
SHOULD NOT =
    generic_phy bcm_kona_usb2_phy phy_pxa_28nm_hsic phy_pxa_28nm_usb2
    # I *think* this is mostly a helper for Broadcom NICs.
    fixed_phy

[→ Firmware Drivers]
SHOULD NOT =
    dcdbas  dell_rbu  dmi_sysfs  edd  firmware_memmap  iscsi_ibft_find
    # only used by qemu?
    fw_cfg_sysfs

[→ File systems]
MUST NOT =
    FS_ENCRYPTION
    # NOTE: upstream Kconfig says
    #          Disable this to get a possibly more secure configuration, but that
    #          might not be backward compatible with previous kernels.
    #       therefore we do disable it, since the overlay isn't shared with older kernels.
    OVERLAY_FS_REDIRECT_ALWAYS_FOLLOW
    OVERLAY_FS_NFS_EXPORT
    # new in 4.19
    OVERLAY_FS_METACOPY
SHOULD NOT =
    autofs4_fs  btrfs_fs   cuse                         dlm      exportfs_block_ops  ext2_fs
    ext3_fs     ext4_fs    fanotify_access_permissions  fs_dax   fuse_fs             gfs2_fs
    jfs_fs      nilfs2_fs  ocfs2_fs                     qfmt_v1  quota               reiserfs_fs
    xfs_fs      zisofs
    autofs_fs
    # New in 5.4
    exfat_fs staging_exfat_fs
    fs_verity
    zonefs_fs

[→ File systems → Caches]
SHOULD NOT =
    cachefiles  fscache_stats

[→ File systems → DOS/FAT/NT Filesystems]
SHOULD NOT =
    msdos_fs ntfs_fs vfat_fs

[→ File systems → Pseudo filesystems]
SHOULD NOT =
    proc_kcore proc_page_monitor hugetlbfs configfs_fs

[→ File systems → Miscellaneous filesystems]
SHOULD NOT =
    adfs_fs    affs_fs       aufs_export   befs_fs        bfs_fs         cramfs      ecrypt_fs
    efivar_fs  efs_fs        exofs_fs      f2fs_fs        hfs_fs         hfsplus_fs  hpfs_fs
    jffs2_fs   logfs         minix_fs      omfs_fs        pstore_ram     qnx4fs_fs   qnx6fs_fs
    romfs_fs   squashfs_lz4  squashfs_lzo  squashfs_zlib  squashfs_zstd  sysv_fs     ubifs_fs
    ufs_fs     vxfs_fs
    orangefs_fs
    ## FIXME: is APEI important enough to leave pstore enabled?
    ##pstore acpi_apei            # inmates with a root privesc exploit shouldn't be able to store things in desktop nvram
    ## UPDATE: per f2f w/russm,
    ##
    ##   * pstore is "for" the kernel to keep reminders;
    ##     userland isn't supposed to be able to write into it:
    ##
    ##       root@het:~# date >/sys/fs/pstore/x
    ##       -bash: /sys/fs/pstore/x: Permission denied
    ##
    ##   * the filesystem is *mounted* rw because userland *is* supposed to
    ##     *delete* things from it, to indicate they've been processed (e.g. into syslog).
    ##
    ##   * pstore needs a backend to remember anything (we think);
    ##     on x86-64 there are only two drivers (we think): EFI and RAM.
    ##     And PSTORE_RAM is definitely disabled.
    ##
    ## So at least in theory, having /sys/fs/pstore mounted is still harmless
    ## because 1) only the kernel can put data there; and 2) it won't be
    ## persistent across a reboot anyway.  --twb, Aug 2015
    ##
    ## UPDATE Jan 2020 -- in Linux 5.6, pstore is the only thing keeping CONFIG_CRYPTO enabled.
    ## Therefore remove it, but maybe put it back later if "reasonable"?
    ## Note that APEI claims to be useful for "NMI handling especially",
    ## which I think is a performance thing?
    ## https://github.com/torvalds/linux/blob/master/drivers/acpi/apei/Kconfig#L8
    ## https://en.wikipedia.org/wiki/Non-maskable_interrupt
    pstore acpi_apei

# otherwise pulls in CRYPTO_DEFLATE + CRYPTO_ACOMP
[→ File systems → Miscellaneous filesystem → Persistent store support]
SHOULD NOT =
    pstore_deflate_compress

[→ File systems → Network File Systems]
SHOULD NOT =
    9p_fs   afs_fs  ceph_fs          cifs          coda_fs  ncp_fs  nfs_swap  nfs_v2  nfs_v3_acl
    nfs_v3  nfsd    rpcsec_gss_krb5  sunrpc_debug

[→ File systems → Native language support]
SHOULD NOT =
    nls_codepage_1250  nls_codepage_1251  nls_codepage_437  nls_codepage_737  nls_codepage_775
    nls_codepage_850   nls_codepage_852   nls_codepage_855  nls_codepage_857  nls_codepage_860
    nls_codepage_861   nls_codepage_862   nls_codepage_863  nls_codepage_864  nls_codepage_865
    nls_codepage_866   nls_codepage_869   nls_codepage_874  nls_codepage_932  nls_codepage_936
    nls_codepage_949   nls_codepage_950   nls_iso8859_1     nls_iso8859_13    nls_iso8859_14
    nls_iso8859_15     nls_iso8859_2      nls_iso8859_3     nls_iso8859_4     nls_iso8859_5
    nls_iso8859_6      nls_iso8859_7      nls_iso8859_8     nls_iso8859_9     nls_koi8_r
    nls_koi8_u         nls_mac_celtic     nls_mac_centeuro  nls_mac_croatian  nls_mac_cyrillic
    nls_mac_gaelic     nls_mac_greek      nls_mac_iceland   nls_mac_inuit     nls_mac_roman
    nls_mac_romanian   nls_mac_turkish

[→ Kernel hacking]
MUST NOT =
    DEBUG_INFO KASAN KCOV RUNTIME_TESTING_MENU
    DEBUG_MISC
SHOULD NOT =
    bug_on_data_corruption  debug_bugverbose  debug_list          early_printk
    fault_injection         ftrace            magic_sysrq_serial  notifier_error_injection
    sched_debug             schedstats        stacktrace          test_firmware
    timer_stats             x86_debug_fpu     x86_verbose_bootup
    debug_plist
    test_lockup

[→ Kernel hacking → Compile-time checks and compiler options]
SHOULD NOT =
    debug_fs headers_install

[→ Kernel hacking → Memory Debugging]
SHOULD NOT =
    kmemcheck

# NOTE: NFSv4 turns on "keys" in (at least) 4.19+.
[→ Security options]
SHOULD NOT =
    keys
    key_dh_operations
    ##FIXME: LEAVE ENABLED FOR NOW?## security_apparmor
    security_selinux security_smack security_tomoyo security_yama_stacked
    # "integrity" was keeping several crypto modules installed
    integrity
    # "security_apparmor_hash" this was keeping crypto_sha1 installed
    security_apparmor_hash
    allow_lockdown_lift_by_sysrq

[→ Cryptographic API]
MUST NOT =
    # CRYPTO_AES is required by INET&&NET, i.e. always.
    # UPDATE this problem went away sometime between 5.2 and 5.3.  Yay!
    CRYPTO
    # CRYPTO_AES is required by INET&&NET, i.e. always.
    # Should we therefore also enable AES_NI_INTEL (faster AES)?
    #
    # UPDATE: per discussion with russm (Oct 2018),
    #  • the risk is very small; and
    #  • the gain is very big; but
    #    only for AES performed by the kernel (e.g. LUKS, but not not curl gnutls).
    # I am therefore inclined to let AES optimizations be allowed
    # (*ONLY* AES, not e.g. camellia via AES-NI).
    #
    # UPDATE: doing so pulls in helpers to choose the best AES implementation on-the-fly:
    #   crypto_manager crypto_manager2 crypto_cryptd crypto_acomp2 crypto_akcipher2 crypto_kpp2
    # …that pushes it back into the "too hard, don't care" basket.
    ASYMMETRIC_PUBLIC_KEY_SUBTYPE      CRYPTO_CHACHA20POLY1305           CRYPTO_ECHAINIV
    CRYPTO_ACOMP2                      CRYPTO_AES_NI_INTEL               CRYPTO_AES_X86_64
    CRYPTO_AKCIPHER                    CRYPTO_AKCIPHER2                  CRYPTO_ANSI_CPRNG
    CRYPTO_ANUBIS                      CRYPTO_ARC4                       CRYPTO_AUTHENC
    CRYPTO_BLOWFISH                    CRYPTO_BLOWFISH_X86_64            CRYPTO_CAMELLIA
    CRYPTO_CAMELLIA_AESNI_AVX2_X86_64  CRYPTO_CAMELLIA_AESNI_AVX_X86_64  CRYPTO_CAMELLIA_X86_64
    CRYPTO_CAST5                       CRYPTO_CAST5_AVX_X86_64           CRYPTO_CAST6
    CRYPTO_CAST6_AVX_X86_64            CRYPTO_CBC                        CRYPTO_CCM
    CRYPTO_CHACHA20                    CRYPTO_CHACHA20_X86_64            CRYPTO_CMAC
    CRYPTO_CRC32                       CRYPTO_CRC32C                     CRYPTO_CRC32C_INTEL
    CRYPTO_CRC32_PCLMUL                CRYPTO_CRCT10DIF                  CRYPTO_CRCT10DIF_PCLMUL
    CRYPTO_CRYPTD                      CRYPTO_CTR                        CRYPTO_CTS
    CRYPTO_DEFLATE                     CRYPTO_DES                        CRYPTO_DES3_EDE_X86_64
    CRYPTO_DH                          CRYPTO_DRBG_MENU                  CRYPTO_ECB
    CRYPTO_ECDH                        CRYPTO_FCRYPT                     CRYPTO_FIPS
    CRYPTO_GCM                         CRYPTO_GF128MUL                   CRYPTO_GHASH
    CRYPTO_GHASH_CLMUL_NI_INTEL        CRYPTO_HMAC                       CRYPTO_HW
    CRYPTO_JITTERENTROPY               CRYPTO_KHAZAD                     CRYPTO_KPP
    CRYPTO_KPP2                        CRYPTO_LRW                        CRYPTO_LZ4
    CRYPTO_LZ4HC                       CRYPTO_LZO                        CRYPTO_MANAGER
    CRYPTO_MANAGER2                    CRYPTO_MD4                        CRYPTO_MD5
    CRYPTO_MICHAEL_MIC                 CRYPTO_NULL                       CRYPTO_PCBC
    CRYPTO_PCRYPT                      CRYPTO_POLY1305                   CRYPTO_POLY1305_X86_64
    CRYPTO_RMD128                      CRYPTO_RMD160                     CRYPTO_RMD256
    CRYPTO_RMD320                      CRYPTO_RNG_DEFAULT                CRYPTO_RSA
    CRYPTO_SALSA20                     CRYPTO_SALSA20_X86_64             CRYPTO_SEED
    CRYPTO_SEQIV                       CRYPTO_SERPENT                    CRYPTO_SERPENT_AVX2_X86_64
    CRYPTO_SERPENT_AVX_X86_64          CRYPTO_SERPENT_SSE2_X86_64        CRYPTO_SHA1
    CRYPTO_SHA1_SSSE3                  CRYPTO_SHA256                     CRYPTO_SHA256_SSSE3
    CRYPTO_SHA3                        CRYPTO_SHA512                     CRYPTO_SHA512_SSSE3
    CRYPTO_TEA                         CRYPTO_TEST                       CRYPTO_TGR192
    CRYPTO_TWOFISH                     CRYPTO_TWOFISH_AVX_X86_64         CRYPTO_TWOFISH_X86_64
    CRYPTO_TWOFISH_X86_64_3WAY         CRYPTO_USER                       CRYPTO_USER_API_AEAD
    CRYPTO_USER_API_HASH               CRYPTO_USER_API_RNG               CRYPTO_USER_API_SKCIPHER
    CRYPTO_VMAC                        CRYPTO_WP512                      CRYPTO_XCBC
    CRYPTO_XTS                         CRYPTO_ZLIB
    CRYPTO_SM3
    ASYMMETRIC_KEY_TYPE CRYPTO_CFB CRYPTO_SM4 CRYPTO_SPECK
    CRYPTO_AEGIS128 CRYPTO_AEGIS128L CRYPTO_AEGIS256 CRYPTO_AEGIS128_AESNI_SSE2
    CRYPTO_AEGIS128L_AESNI_SSE2 CRYPTO_AEGIS256_AESNI_SSE2 CRYPTO_MORUS640 CRYPTO_MORUS640_SSE2
    CRYPTO_MORUS1280 CRYPTO_MORUS1280_SSE2 CRYPTO_MORUS1280_AVX2 CRYPTO_ZSTD
    SYSTEM_BLACKLIST_KEYRING
    CRYPTO_ECRDSA CRYPTO_OFB CRYPTO_NHPOLY1305_SSE2 CRYPTO_NHPOLY1305_AVX2 CRYPTO_ADIANTUM CRYPTO_STREEBOG
    CRYPTO_XXHASH
    CRYPTO_ESSIV

[→ Virtualization]
SHOULD NOT = virtualization

[→ Library routines]
SHOULD NOT =
    average cordic crc16 crc7 crc8 crc_ccitt crc_t10dif libcrc32c irq_poll string_selftest
    crc64 dimlib
